{% extends "shop/base.html" %}
    {% block page_title %}
        Login
    {% endblock page_title %}
    {% block search-bar %}
    {% endblock search-bar %}
    {% block content %}
    <div class="bigdiv">
        {% load static %}
        <link rel="stylesheet" href="{% static 'css/log.css' %}">
        
        <!-- ì²« ë²ˆì§¸ í™”ë©´ -->
        <div id="first-screen" class="screen">
            <span class="spanname">
                30CM ì´ìš© ì•½ê´€ì—
                <br>
                ë™ì˜í•´ ì£¼ì„¸ìš”
            </span>
            <div class="sighemail" style="margin-top: 60px;">
                <div class="agree">
                    <label class="checkbox-label">
                        <input type="checkbox" id="check-all" class="agree-checkbox">
                        <span class="checkbox-custom"></span>
                        ì „ì²´ ë™ì˜í•˜ê¸° (ì„ íƒ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.)
                    </label>
                    <p class="agree-description" style="margin-left: 30px;">
                        ì„ íƒ ì‚¬í•­ì— ëŒ€í•œ ë™ì˜ë¥¼ ê±°ë¶€í•˜ëŠ” ê²½ìš°ì—ë„<br>
                        ì„œë¹„ìŠ¤ëŠ” ì´ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </p>
                </div>
                <div class="divider"></div>
                <div class="terms-container">
                    <div class="term-item">
                        <label>
                            <input type="checkbox" class="checkbox-input individual-check">
                            <span class="checkbox-custom"></span>
                            [í•„ìˆ˜] ë§Œ 14ì„¸ ì´ìƒì…ë‹ˆë‹¤
                        </label>
                    </div>
                    <div class="term-item">
                        <label>
                            <input type="checkbox" class="checkbox-input individual-check">
                            <span class="checkbox-custom"></span>
                            [í•„ìˆ˜] ì´ìš©ì•½ê´€ ë™ì˜
                        </label>
                        <a href="#" class="detail-link">ìì„¸íˆ</a>
                    </div>
                    <div class="term-item">
                        <label>
                            <input type="checkbox" class="checkbox-input individual-check">
                            <span class="checkbox-custom"></span>
                            [ì„ íƒ] ë§ˆì¼€íŒ… ëª©ì ì˜ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜
                        </label>
                        <a href="#" class="detail-link">ìì„¸íˆ</a>
                    </div>
                    <div class="term-item">
                        <label>
                            <input type="checkbox" class="checkbox-input individual-check">
                            <span class="checkbox-custom"></span>
                            [ì„ íƒ] ê´‘ê³ ì„± ì •ë³´ ìˆ˜ì‹  ë™ì˜
                        </label>
                        <a href="#" class="detail-link">ìì„¸íˆ</a>
                    </div>
                </div>
                <p class="privacy-policy">
                    ì •ë³´ì£¼ì²´ì˜ ê°œì¸ì •ë³´ ë° ê¶Œë¦¬ ë³´í˜¸ë¥¼ ìœ„í•´ ã€Œê°œì¸ì •ë³´ ë³´í˜¸ë²•ã€ ë° ê´€ê³„ ë²•ë ¹ì´ ì •í•œ ë°”ë¥¼ ì¤€ìˆ˜í•˜ì—¬ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. 
                    ìì„¸í•œ ì‚¬í•­ì€ <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <button id="next-button" class="next-button" type="button" disabled>ë‹¤ìŒ</button>
            </div>
        </div>
        
        <!-- ë‘ ë²ˆì§¸ í™”ë©´ -->
        <div id="second-screen" class="screen" style="display: none;">
            <span class="spanname">
                ë¡œê·¸ì¸ì— ì‚¬ìš©í• 
                <br>
                ì•„ì´ë””ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.
            </span>
            <div class="signup-form" style="margin-top: 60px;">
                <form method="post" action="{% url 'users:join_email' %}">
                    {% csrf_token %}
                    <div>
                        <label for="{{ form.email.id_for_label }}" class="small-label">ì´ë©”ì¼(ì•„ì´ë””)</label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="error">
                                {% for error in form.email.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </form>
            </div>
            <button id="submit-button" class="next-button" type="button" disabled style="margin-top:70px">ë‹¤ìŒ</button>
        </div>

        <div id="third-screen" class="screen" style="display: block;">
            <span class="spanname">
                ë¡œê·¸ì¸ì— ì‚¬ìš©í• <br>
                ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.
            </span>
            <div class="signup-form" style="margin-top: 60px;">
                <form method="post" action="{% url 'users:signup' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="password" class="small-label">ë¹„ë°€ë²ˆí˜¸</label>
                        <div class="input-container">
                            <input type="password" id="password" name="password" class="password-input" placeholder="8ì ì´ìƒì˜ ë¹„ë°€ë²ˆí˜¸" required>
                            <button type="button" class="toggle-password">ğŸ‘ï¸</button>
                        </div>
                        <small class="input-hint">âœ“ 8-20ì ì´ë‚´ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨</small>
                    </div>
                    <div class="form-group">
                        <label for="password1" class="small-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                        <div class="input-container">
                            <input type="password" id="password1" name="password1" class="password-input" placeholder="8ì ì´ìƒì˜ ë¹„ë°€ë²ˆí˜¸" required>
                            <button type="button" class="toggle-password">ğŸ‘ï¸</button>
                        </div>
                        <small class="input-hint" id="password-match-hint">âœ“ ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜</small>
                    </div>
                    <button type="submit" class="next-button">ë‹¤ìŒ</button>
                </form>
            </div>
        </div>

        <!-- ë„¤ ë²ˆì§¸ í™”ë©´ -->
        <div id="fourth-screen" class="screen" style="display: none;">
            <span class="spanname">
                ì´ë¦„ê³¼ ì „í™”ë²ˆí˜¸, ìƒì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.
            </span>
            <div class="signup-form" style="margin-top: 60px;">
                <form method="post" action="{% url 'users:signup_complete' %}">
                    {% csrf_token %}
                    <div class="form-group">
                            <label for="name" class="small-label">ì´ë¦„</label>
                            <input type="text" id="name" name="name" class="form-control1" placeholder="ì´ë¦„ ì…ë ¥" maxlength="10" required>
                    </div>
                    <div class="form-group">
                        <label for="tel" class="small-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="tel" name="tel" class="form-control1" placeholder="ì „í™”ë²ˆí˜¸ ì…ë ¥ ('-' ì œì™¸)" maxlength="11" required>
                    </div>
                    <div class="form-group">
                        <label for="birthday" class="small-label">ìƒì¼</label>
                        <input type="date" id="birthday" name="birthday" class="form-control1" placeholder="ìƒì¼ ì…ë ¥ (YYYY-MM-DD)" required>
                    </div>
                    <button type="submit" class="next-button">ì™„ë£Œ</button>
                </form>
            </div>
        </div>

        

    </div>
    
    <script>
        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const checkAll = document.getElementById('check-all');
        const individualChecks = document.querySelectorAll('.individual-check');
        const nextButton = document.getElementById('next-button');
        const firstScreen = document.getElementById('first-screen');
        const secondScreen = document.getElementById('second-screen');
        const thirdScreen = document.getElementById("third-screen");
    
        // "ì „ì²´ ë™ì˜í•˜ê¸°" ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
        checkAll.addEventListener('change', function () {
            const isChecked = checkAll.checked;
            individualChecks.forEach((checkbox) => {
                checkbox.checked = isChecked;
            });
            toggleNextButton();
        });
    
        // ê°œë³„ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
        individualChecks.forEach((checkbox) => {
            checkbox.addEventListener('change', function () {
                const allChecked = Array.from(individualChecks).every((checkbox) => checkbox.checked);
                checkAll.checked = allChecked;
                toggleNextButton();
            });
        });
    
        // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™” í† ê¸€ í•¨ìˆ˜
        function toggleNextButton() {
            const allRequiredChecked = Array.from(individualChecks)
                .slice(0, 2) // í•„ìˆ˜ í•­ëª©ë§Œ ì²´í¬
                .every((checkbox) => checkbox.checked);
    
            if (allRequiredChecked) {
                nextButton.disabled = false;
                nextButton.style.backgroundColor = '#000000'; // í™œì„±í™” ìŠ¤íƒ€ì¼
                nextButton.style.color = '#FFFFFF';
                nextButton.style.cursor = 'pointer';
            } else {
                nextButton.disabled = true;
                nextButton.style.backgroundColor = '#ccc'; // ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼
                nextButton.style.cursor = 'not-allowed';
            }
        }
    
        document.addEventListener("DOMContentLoaded", function () {
            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            document.getElementById("first-screen").style.display = "block"; // ì²« ë²ˆì§¸ í™”ë©´ í‘œì‹œ
            document.getElementById("second-screen").style.display = "none"; // ë‘ ë²ˆì§¸ í™”ë©´ ìˆ¨ê¸°ê¸°
            document.getElementById("third-screen").style.display = "none"; // ì„¸ ë²ˆì§¸ í™”ë©´ ìˆ¨ê¸°ê¸°
        });

        // ì²« ë²ˆì§¸ -> ë‘ ë²ˆì§¸ í™”ë©´ ì „í™˜
    nextButton.addEventListener("click", function () {
        if (!this.disabled) {
            firstScreen.style.display = "none";
            secondScreen.style.display = "block";
        }
    });

    // ë‘ ë²ˆì§¸ -> ì„¸ ë²ˆì§¸ í™”ë©´ ì „í™˜
    document.addEventListener("DOMContentLoaded", function () {
        const emailInput = document.querySelector('input[name="email"]');
        const submitButton = document.getElementById("submit-button");
        const emailErrorDiv = document.createElement("div");
        emailErrorDiv.className = "error";
        emailInput.parentElement.appendChild(emailErrorDiv);
    
        // ì—”í„°í‚¤ë¥¼ ëˆŒë €ì„ ë•Œ ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
        emailInput.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault(); // ê¸°ë³¸ submit ë™ì‘ ë°©ì§€
                if (!submitButton.disabled) {
                    submitButton.click(); // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                }
            }
        });
    
        submitButton.addEventListener("click", function (event) {
            event.preventDefault();
            const email = emailInput.value.trim();
    
            fetch("{% url 'users:store_session_data' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}",
                },
                body: JSON.stringify({ email }),
            })
            .then((response) => {
                if (response.ok) {
                    document.getElementById("second-screen").style.display = "none";
                    document.getElementById("third-screen").style.display = "block";
                } else {
                    alert("ì„¸ì…˜ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });
        });
    
        // ì´ë©”ì¼ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ ê²€ì¦
        emailInput.addEventListener("input", function () {
            const emailValue = emailInput.value.trim();
    
            // AJAX ìš”ì²­ìœ¼ë¡œ ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì¦
            fetch("{% url 'users:validate_email' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}",
                },
                body: JSON.stringify({ email: emailValue }),
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.valid) {
                    emailInput.classList.remove("input-error");
                    emailErrorDiv.textContent = "";
                    enableSubmitButton();
                } else {
                    emailInput.classList.add("input-error");
                    emailErrorDiv.textContent = data.error;
                    disableSubmitButton();
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                emailInput.classList.add("input-error");
                emailErrorDiv.textContent = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                disableSubmitButton();
            });
    
            // ì´ë©”ì¼ì´ ë¹„ì–´ ìˆìœ¼ë©´ ì´ˆê¸°í™”
            if (emailValue === "") {
                emailInput.classList.remove("input-error");
                emailErrorDiv.textContent = "";
                disableSubmitButton();
            }
        });
    
        function enableSubmitButton() {
            submitButton.disabled = false;
            submitButton.style.backgroundColor = "#000000";
            submitButton.style.color = "#FFFFFF";
            submitButton.style.cursor = "pointer";
        }
    
        function disableSubmitButton() {
            submitButton.disabled = true;
            submitButton.style.backgroundColor = "#ccc";
            submitButton.style.cursor = "not-allowed";
        }
    });
    

    const thirdNextButton = document.querySelector("#third-screen .next-button");

    thirdNextButton.addEventListener("click", function () {
        const thirdScreen = document.getElementById("third-screen");
            const fourthScreen = document.getElementById("fourth-screen");

        // ì„¸ ë²ˆì§¸ í™”ë©´ì—ì„œ ë„¤ ë²ˆì§¸ í™”ë©´ìœ¼ë¡œ ì „í™˜
        thirdScreen.style.display = "none";
        fourthScreen.style.display = "block";
    });

    document.addEventListener("DOMContentLoaded", function () {
        const passwordInput = document.getElementById("password"); // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ
        const passwordConfirmInput = document.getElementById("password1"); // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•„ë“œ
        const nextButton = document.querySelector("#third-screen .next-button"); // "ë‹¤ìŒ" ë²„íŠ¼
        const passwordMatchHint = document.getElementById("password-match-hint"); // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í…ìŠ¤íŠ¸
        const passwordCriteriaHint = document.querySelector(".input-hint"); // ë¹„ë°€ë²ˆí˜¸ ì¡°ê±´ í…ìŠ¤íŠ¸
        const thirdScreen = document.getElementById("third-screen"); // ì„¸ ë²ˆì§¸ í™”ë©´
        const fourthScreen = document.getElementById("fourth-screen"); // ë„¤ ë²ˆì§¸ í™”ë©´
    
        // ë¹„ë°€ë²ˆí˜¸ ì¡°ê±´ ê²€ì¦ í•¨ìˆ˜
        function isPasswordValid(password) {
            const passwordRegex = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,20}$/;
            return passwordRegex.test(password);
        }
    
        // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ë° ì¡°ê±´ ê²€ì¦ í•¨ìˆ˜
        function checkPasswordMatch() {
            const password = passwordInput.value.trim(); // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ê°’
            const confirmPassword = passwordConfirmInput.value.trim(); // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ê°’
            const isValid = isPasswordValid(password); // ë¹„ë°€ë²ˆí˜¸ ì¡°ê±´ ì²´í¬ ê²°ê³¼
    
            // ë¹„ë°€ë²ˆí˜¸ê°€ ë¹„ì–´ ìˆëŠ” ê²½ìš° ë²„íŠ¼ ë¹„í™œì„±í™”
            if (password === "") {
                disableNextButton();
                return;
            }
    
            // ë¹„ë°€ë²ˆí˜¸ ì¡°ê±´ ì¶©ì¡± ì—¬ë¶€
            if (isValid) {
                passwordCriteriaHint.style.color = "#007BFF"; // ì¡°ê±´ ì¶©ì¡± ì‹œ íŒŒë€ìƒ‰
            } else {
                passwordCriteriaHint.style.color = "#6c757d"; // ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ íšŒìƒ‰
            }
    
            // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€
            if (password === confirmPassword && isValid) {
                passwordMatchHint.style.color = "#007BFF"; // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì‹œ íŒŒë€ìƒ‰
                enableNextButton(); // ë²„íŠ¼ í™œì„±í™”
            } else {
                passwordMatchHint.style.color = "#6c757d"; // ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜ ì‹œ íšŒìƒ‰
                disableNextButton(); // ë²„íŠ¼ ë¹„í™œì„±í™”
            }
        }
    
        // "ë‹¤ìŒ" ë²„íŠ¼ í™œì„±í™” í•¨ìˆ˜
        function enableNextButton() {
            nextButton.disabled = false;
            nextButton.style.backgroundColor = "#000000"; // í™œì„±í™” ìŠ¤íƒ€ì¼
            nextButton.style.color = "#FFFFFF";
            nextButton.style.cursor = "pointer";
        }
    
        // "ë‹¤ìŒ" ë²„íŠ¼ ë¹„í™œì„±í™” í•¨ìˆ˜
        function disableNextButton() {
            nextButton.disabled = true;
            nextButton.style.backgroundColor = "#f4f4f4"; // ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼
            nextButton.style.cursor = "not-allowed";
        }
    
        // "ë‹¤ìŒ" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        nextButton.addEventListener("click", function (event) {
            event.preventDefault();
            const password = document.querySelector('input[name="password"]').value;
    
            fetch("{% url 'users:store_session_data' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}",
                },
                body: JSON.stringify({ password }),
            })
            .then((response) => {
                if (response.ok) {
                    thirdScreen.style.display = "none";
                    fourthScreen.style.display = "block";
                } else {
                    alert("ì„¸ì…˜ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });
        });
    
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        passwordInput.addEventListener("input", checkPasswordMatch);
        passwordConfirmInput.addEventListener("input", checkPasswordMatch);
    
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
        disableNextButton();
    });
    document.addEventListener("DOMContentLoaded", function () {
        const passwordInputs = document.querySelectorAll('.input-container input[type="password"]');
        const toggleButtons = document.querySelectorAll('.toggle-password');
    
        toggleButtons.forEach((toggleButton, index) => {
            toggleButton.addEventListener("click", function () {
                const passwordInput = passwordInputs[index];
                const isPassword = passwordInput.type === "password";
                passwordInput.type = isPassword ? "text" : "password";
                toggleButton.textContent = isPassword ? "ğŸ™ˆ" : "ğŸ‘ï¸"; // ì•„ì´ì½˜ ë³€ê²½
            });
        });
    });
    
    document.addEventListener("DOMContentLoaded", function () {
        const nameInput = document.getElementById("name");
        const telInput = document.getElementById("tel");
        const birthdayInput = document.getElementById("birthday");
        const completeButton = document.querySelector("#fourth-screen .next-button");
    
        // ì´ˆê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
        disableCompleteButton();
    
        // ëª¨ë“  ì…ë ¥ í•„ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        [nameInput, telInput, birthdayInput].forEach((input) => {
            input.addEventListener("input", validateForm);
        });
    
        // í¼ ê²€ì¦ í•¨ìˆ˜
        function validateForm() {
            const isNameValid = nameInput.value.trim() !== "";
            const isTelValid = telInput.value.trim() !== "" && telInput.value.trim().length === 11; // ì „í™”ë²ˆí˜¸ ê¸¸ì´ ì²´í¬
            const isBirthdayValid = birthdayInput.value.trim() !== "";
    
            if (isNameValid && isTelValid && isBirthdayValid) {
                enableCompleteButton();
            } else {
                disableCompleteButton();
            }
        }
    
        // ë²„íŠ¼ í™œì„±í™” í•¨ìˆ˜
        function enableCompleteButton() {
            completeButton.disabled = false;
            completeButton.style.backgroundColor = "#000000";
            completeButton.style.color = "#FFFFFF";
            completeButton.style.cursor = "pointer";
        }
    
        // ë²„íŠ¼ ë¹„í™œì„±í™” í•¨ìˆ˜
        function disableCompleteButton() {
            completeButton.disabled = true;
            completeButton.style.backgroundColor = "#ccc";
            completeButton.style.cursor = "not-allowed";
        }
    });
    
    
    
    </script>
    <style>
        .error {
            color: #D53F00; /* ê¸€ììƒ‰ì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì„¤ì • */
            font-size: 13px; /* ê¸€ì í¬ê¸° ì¡°ì • (ì„ íƒ ì‚¬í•­) */
            margin-top: 5px; /* ìœ„ì•„ë˜ ê°„ê²© ì¶”ê°€ */
        }
        .input-error {
            border: 2px solid #D53F00; /* í…Œë‘ë¦¬ë¥¼ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì„¤ì • */
            border-radius: 4px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            border-width: 1px;
        }
    </style>
{% endblock content %}
